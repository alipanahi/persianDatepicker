/*
 * persian-datepicker -  1.0.1
 * Ali Hussain Panahi <p.alihussain@gmail.com>
 */
const miladi_month_days=[31,28,31,30,31,30,31,31,30,31,30,31],shamsi_month_days=[31,31,31,31,31,31,30,30,30,30,30,29],shamsi_months_da=["حمل","ثور","جوزا","سرطان","اسد","سنبله","میزان","عقرب","قوس","جدی","دلو","حوت"],shamsi_months_pa=["وری","غویی","غبرګولی","چنګاښ","زمری","وږی","تله","لړم","لیندی","مرغومی","سلواغه","کب"],shamsi_months_fa=["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"],miladi_months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let body=document.getElementsByTagName("body")[0],section=document.createElement("section");section.setAttribute("id","container"),body.appendChild(section);let sectionContent='\n<header>\n    <button class="today" id="todayBtn">امروز</button>\n    <h1><span id="shamsiDate"></span></h1>\n    <div class="week-days" dir="rtl">\n        <p>ش</p>\n        <p>ی</p>\n        <p>د</p>\n        <p>س</p>\n        <p>چ</p>\n        <p>پ</p>\n        <p>ج</p>\n    </div>\n    <div id="days" dir="rtl"></div>\n</header>\n<div class="actions">\n    <button id="nextMonth" aria-label="Previous"><</button>\n    <button id="previousMonth" aria-label="Next">></button>\n</div>\n<div id="modal" style="display:none">\n    <select id="select_year"></select>\n    <select id="select_month"></select>\n    <button id="modalBtn" class="modalBtn">انتخاب</button>\n</div>\n';section.innerHTML=sectionContent,section.style.display="none";let container=document.getElementById("container");const modal=document.getElementById("modal"),shamsiDateSpan=document.getElementById("shamsiDate"),daysDiv=document.getElementById("days"),nextBtn=document.getElementById("nextMonth"),previousBtn=document.getElementById("previousMonth"),modalOpen=document.getElementById("modalBtn"),todayBtn=document.getElementById("todayBtn");let selectedMonth=0,selectedYear=0,selectedDay=0,currentSYear=0,currentSMonth=0,currentSDay=0,isCurrentMoth=!0,paired=[],settings={format:"yyyy/mm/dd",autoClose:!0,dateSeparator:"/",labelLanguage:"dari"},textBox="";function renderToday(){clearOldData();let e=Date.now(),t=new Date(e).toLocaleDateString().split("/"),n=t[0],a=t[1],d=dateToShamsi(t[2],n,a);selectedYear=d[0],selectedMonth=d[1],selectedDay=d[2],renderCalendar(d[0],d[1],d[2]),putDate(d[2])}function renderCalendar(e,t,n){t!=currentSMonth&&0!=t||e!=currentSYear||n==selectedDay||(isCurrentMoth=!0);let a=shamsi_months_da[t-1];settings.labelLanguage&&("pashto"==settings.labelLanguage?a=shamsi_months_pa[t-1]:"farsi"==settings.labelLanguage&&(a=shamsi_months_fa[t-1])),shamsiDateSpan.textContent=e+" "+a;let d=dateToMiladi(e,t,1),s=12==t&&shamsiIsLeap(e)?30:shamsi_month_days[t-1],l=dateToMiladi(e,t,s),o=new Date(d[0],d[1]-1,d[2]).getDay(),i=new Date(l[0],l[1]-1,l[2]).getDay();if(6!=o)for(let e=0;e<=o;e++){let e=document.createElement("span");e.classList.add("day"),daysDiv.appendChild(e)}for(let e=1;e<=s;e++){let t=document.createElement("div");t.setAttribute("id","day_"+e),t.setAttribute("onclick","putDate("+e+")"),t.classList.add("day"),e==currentSDay&&isCurrentMoth?t.classList.add("current-day"):e==selectedDay&&t.classList.add("current-day"),daysDiv.appendChild(t);let n=document.createElement("span");n.classList.add("shamsi_day"),n.textContent=e,document.getElementById("day_"+e).appendChild(n)}if(6!=i)for(let e=i;e<5;e++){let e=document.createElement("span");e.classList.add("day"),daysDiv.appendChild(e)}else{let e=document.createElement("span");e.classList.add("day"),daysDiv.appendChild(e)}}function dateToShamsi(e,t,n){let a=e-1600,d=t-1,s=n-1,l=365*a+div(a+3,4)-div(a+99,100)+div(a+399,400);for(let e=0;e<d;++e)l+=miladi_month_days[e];d>1&&(a%4==0&&a%100!=0||a%400==0)&&++l;let o=(l+=s)-79,i=979+33*div(o,12053)+4*div(o%=12053,1461);(o%=1461)>=366&&(i+=div(o-1,365),o=(o-1)%365);let r=0;for(let e=0;e<11&&o>=shamsi_month_days[e];++e)o-=shamsi_month_days[e],r=e+1;let c=r+1;selectedMonth=c,selectedYear=i,currentSMonth=c,currentSYear=i;let m=o+1;return currentSDay=m,[i,c,m]}function dateToMiladi(e,t,n){let a=e-979,d=t-1,s=n-1,l=365*a+8*div(a,33)+div(a%33+3,4);for(let e=0;e<d;++e)l+=shamsi_month_days[e];let o=(l+=s)+79,i=1600+400*div(o,146097),r=1;(o%=146097)>=36525&&(i+=100*div(o-=1,36524),(o%=36524)>=365?o+=1:r=0),i+=4*div(o,1461),(o%=1461)>=366&&(r=0,i+=div(o-=1,365),o%=365);let c=0,m=0;for(;o>=miladi_month_days[c]+m;)m=1==c&&1==r?1:0,o-=miladi_month_days[c]+m,c+=1;return[i,c+1,o+1]}function loadNextMonth(){clearOldData(),12==selectedMonth?(selectedMonth=1,selectedYear+=1):selectedMonth+=1,renderCalendar(selectedYear,selectedMonth,selectedDay)}function loadPreviousMonth(){clearOldData(),1==selectedMonth?(selectedMonth=12,selectedYear-=1):selectedMonth-=1,renderCalendar(selectedYear,selectedMonth,selectedDay)}function LoadModal(){document.getElementById("select_year").textContent="",document.getElementById("select_month").textContent="";let e=shamsi_months_da;settings.labelLanguage&&("pashto"==settings.labelLanguage?e=shamsi_months_pa:"farsi"==settings.labelLanguage&&(e=shamsi_months_fa));for(let e=currentSYear-50;e<=currentSYear+10;e++){let t=document.createElement("option");t.setAttribute("value",e),e==selectedYear&&t.setAttribute("selected","selected"),t.textContent=e,document.getElementById("select_year").appendChild(t)}for(let t=0;t<12;t++){let n=document.createElement("option");n.setAttribute("value",t+1),t+1==selectedMonth&&n.setAttribute("selected","selected"),n.textContent=e[t],document.getElementById("select_month").appendChild(n)}modal.style.display="block"}function renderModal(){let e=document.getElementById("select_year").value,t=document.getElementById("select_month").value;clearOldData(),selectedYear=parseInt(e),selectedMonth=parseInt(t),modal.style.display="none",renderCalendar(e,t,1)}function loadDatepicker(e){if(""==e.value)selectedDay=0,renderToday();else{clearOldData();let t,n,a,d=settings.dateSeparator?settings.dateSeparator:"/",s=e.value.split(d);if(settings.format){let e=settings.format.split("/");"yyyy"===e[0]&&"mm"===e[1]&&"dd"===e[2]?(t=s[0],n=s[1],a=s[2]):"yyyy"===e[0]&&"dd"===e[1]&&"mm"===e[2]?(t=s[0],n=s[2],a=s[1]):"dd"===e[0]&&"mm"===e[1]&&"yyyy"===e[2]?(t=s[2],n=s[1],a=s[0]):"dd"===e[0]&&"yyyy"===e[1]&&"mm"===e[2]?(t=s[1],n=s[2],a=s[0]):"mm"===e[0]&&"dd"===e[1]&&"yyyy"===e[2]?(t=s[2],n=s[0],a=s[1]):"mm"===e[0]&&"yyyy"===e[1]&&"dd"===e[2]&&(t=s[1],n=s[0],a=s[2])}else t=s[0],n=s[1],a=s[2];selectedDay=a,renderCalendar(t,n,a)}textBox=e;let t=e.getBoundingClientRect().top,n=e.getBoundingClientRect().height,a=e.getBoundingClientRect().left;container.style.left=a+"px",container.style.top=t+n+"px",container.style.display="block",document.addEventListener("mouseup",function(e){container.contains(e.target)||(document.getElementById("modal").style.display="none",container.style.display="none")})}function putDate(e){let t=selectedMonth<10?"0"+selectedMonth:selectedMonth;e=e<10?"0"+e:e;let n=settings.dateSeparator?settings.dateSeparator:"/";if(settings.format){let a=settings.format.split("/");"yyyy"===a[0]&&"mm"===a[1]&&"dd"===a[2]?textBox.value=selectedYear+n+t+n+e:"yyyy"===a[0]&&"dd"===a[1]&&"mm"===a[2]?textBox.value=selectedYear+n+e+n+t:"dd"===a[0]&&"mm"===a[1]&&"yyyy"===a[2]?textBox.value=e+n+t+n+selectedYear:"dd"===a[0]&&"yyyy"===a[1]&&"mm"===a[2]?textBox.value=e+n+selectedYear+n+t:"mm"===a[0]&&"dd"===a[1]&&"yyyy"===a[2]?textBox.value=t+n+e+sseperator+selectedYear:"mm"===a[0]&&"yyyy"===a[1]&&"dd"===a[2]&&(textBox.value=t+n+selectedYear+n+e)}else textBox.value=selectedYear+n+t+n+e;!1===settings.autoClose?container.style.display="block":container.style.display="none"}nextBtn.addEventListener("click",loadNextMonth),previousBtn.addEventListener("click",loadPreviousMonth),shamsiDateSpan.addEventListener("click",LoadModal),modalOpen.addEventListener("click",renderModal),todayBtn.addEventListener("click",renderToday),window.onclick=function(e){e.target==modal&&(modal.style.display="none")},window.addEventListener("mouseup",function(e){"datepicker-farsi"==e.target.classList&&e.target.addEventListener("click",loadDatepicker(e.target))});const div=(e,t)=>Math.floor(e/t);function clearOldData(){shamsiDateSpan.innerHTML="",daysDiv.innerHTML="",isCurrentMoth=!1}const miladiIsLeap=e=>e%4==0&&(e%100!=0||e%400==0),shamsiIsLeap=e=>(e=(e=((e=(e-474)%128)>=30?0:29)+e)-Math.floor(e/33)-1)%4==0;